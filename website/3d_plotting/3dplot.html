<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>
        3D Visualization
    </title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />
    <!--     Fonts and icons     -->
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
    <!-- CSS Files -->
    <link href="../assets/css/material-dashboard.css?v=2.1.0" rel="stylesheet" />
</head>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<!-- <script src="./script.js"></script> -->

<body>
    <div id="main">
        <div class="wrapper" id="wrap">
            <div class="sidebar" data-color="purple" data-background-color="purple" data-image="../assets/img/sidebar-1.jpg">
                <div class="logo">
                    <a href="" class="simple-text logo-normal">
          Command Center
        </a>
                </div>
                <div class="sidebar-wrapper">
                    <ul class="nav">
                        <li class="nav-item  ">
                            <a class="nav-link" href="./dashboard.html">
              <i class="material-icons">dashboard</i>
              <p>Dashboard</p>
            </a>
                            <li class="nav-item active ">
                                <a class="nav-link" href="./3dplot.html">
              <i class="material-icons">library_books</i>
              <p>3D Visualization</p>
            </a>
                    </ul>
                </div>
            </div>
            <div class="main-panel">
                <!-- Navbar -->
                <nav class="navbar navbar-expand-lg navbar-transparent navbar-absolute fixed-top ">
                    <div class="container-fluid">
                        <div class="navbar-wrapper">
                            <a class="navbar-brand" href="#pablo">3D Visualization</a>
                        </div>
                        <button class="navbar-toggler" type="button" data-toggle="collapse" aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="navbar-toggler-icon icon-bar"></span>
                            <span class="navbar-toggler-icon icon-bar"></span>
                            <span class="navbar-toggler-icon icon-bar"></span>
                        </button>
                    </div>
                </nav>
                <!-- End Navbar -->
                <div class="content">
                    <div class="container-fluid">
                        <div class="card">
                            <div class="card-header card-header-primary">
                                <h4 class="card-title">3D Visualization</h4>
                            </div>
                            <div class="card-body">
                                <div class="card-title">
                                    <div id="graph" class="graph_class">Graph</div>
                                    <script type="text/javascript">
                                    var socket = io.connect('http://localhost:3000');

                                    var x = [];
                                    var y = [];
                                    var z = [];
                                    var c = [];
                                    var numSamples = 0;
                                    console.log(document)
                                    var graph = document.getElementById("graph")
                                    console.log(graph)
                                    Plotly.plot(graph, [{
                                        type: 'scatter3d',
                                        mode: 'lines',
                                        x: x,
                                        y: y,
                                        z: z,
                                        opacity: 0.7,
                                        line: {
                                            width: 10,
                                            color: c,
                                            colorscale: 'Viridis'
                                        }
                                    }]);

                                    socket.on('plot-update', (d) => {
                                        if (d != null) {
                                            const readings = d.data.split(',');
                                            x.push(readings[0]);
                                            y.push(readings[1]);
                                            z.push(readings[2])
                                            c.push(Math.floor(Math.random() * 256))
                                            numSamples += 1;

                                            Plotly.react(graph, [{
                                                type: 'scatter3d',
                                                mode: 'lines',
                                                autosize: true,
                                                width: 800,
                                                height: 800,
                                                x: x,
                                                y: y,
                                                z: z,
                                                opacity: 0.7,
                                                line: {
                                                    width: 5,
                                                    color: c,
                                                    colorscale: 'Viridis'
                                                }
                                            }]);

                                            if (numSamples >= 500) {
                                                Plotly.purge('graph')
                                                Plotly.plot('graph', [{
                                                    type: 'scatter3d',
                                                    mode: 'lines',
                                                    autosize: true,
                                                    width: 800,
                                                    height: 800,
                                                    x: x,
                                                    y: y,
                                                    z: z,
                                                    opacity: 0.7,
                                                    line: {
                                                        width: 10,
                                                        color: c,
                                                        colorscale: 'Viridis'
                                                    }
                                                }]);

                                                x = [];
                                                y = [];
                                                z = [];
                                                c = [];

                                                x.length = 0;
                                                y.length = 0;
                                                z.length = 0;
                                                c.length = 0;

                                                numSamples = 0;
                                            }
                                            console.log(numSamples)
                                        }

                                    });
                                    </script>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<!--   Core JS Files   -->
<script src="../assets/js/core/jquery.min.js" type="text/javascript"></script>
<script src="../assets/js/core/popper.min.js" type="text/javascript"></script>
<script src="../assets/js/core/bootstrap-material-design.min.js" type="text/javascript"></script>
<script src="../assets/js/plugins/perfect-scrollbar.jquery.min.js"></script>
<script src="../assets/js/plugins/bootstrap-notify.js"></script>
<!-- Control Center for Material Dashboard: parallax effects, scripts for the example pages etc -->
<script src="../assets/js/material-dashboard.min.js?v=2.1.0" type="text/javascript"></script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="shortcut icon" type="image/png" href="./website/favicon.ico" />
<script type="text/javascript" src="./website/smoothie.js"></script>
<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
</body>

</html>